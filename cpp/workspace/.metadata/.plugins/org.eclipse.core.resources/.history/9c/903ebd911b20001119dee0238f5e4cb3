
#include <iostream>
#include <stdio.h>
#include <stdlib.h>
#include <string.h>

using namespace std;

 class SerCon{
 public :
    char host[255];
    int port;
    char filename[255];
    SerCon(void);
    void parse(char *,const char *);
    void show(void);
 };

    SerCon::SerCon(void){
         memset(host,0,sizeof(host));
         memset(filename,0,sizeof(filename));
         port=0;
    }
    void SerCon::parse (char *query,const char *s){

       char sport[5];
       sscanf(query,s,host,sport,filename);

       printf("pares=%s",s);
       port=atoi(sport);
    }
    void SerCon::show(void){
       printf("h=%s,p=%d,f=%s<br />",host,port,filename);
    }

SerCon sc[5];

int main(int argc, char* argv[], char *envp[]) {


        printf("Content-type: text/html\n\n");
        char *query = getenv("QUERY_STRING");
        if(query==NULL){
       	char testquery[]="h1=127.0.0.1&p1=800&f1=test1.txt&h2=&p2=&f2=&h3=&p3=&f3=&h4=&p4=&f4=&h5=&p5=&f5=";
           query=testquery;
        }
        printf("query=%s<br />\n", query);

        SerCon sc[0]=SerCon();
         try{
          const char *parse_str1="h1=%[^&]&p1=%d&f1=%[^&]";
          sc[0].parse(query,parse_str1);
         }catch(...){
            cout <<"s1 parse error!";
         }
        sc[0].show();
	cout << "Hello World!!!" << endl;
	return 0;
}
