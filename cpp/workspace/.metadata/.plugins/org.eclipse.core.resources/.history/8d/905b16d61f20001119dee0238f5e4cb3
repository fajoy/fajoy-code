#include <iostream>
#include <stdio.h>
#include <stdlib.h>
#include <string.h>

using namespace std;

class SerCon {
public:
	char host[255];
	int port;
	char filename[255];
	SerCon(void);
	void parse(char *, const char *);
	void show(void);
};

SerCon::SerCon(void) {
	memset(host, 0, sizeof(host));
	memset(filename, 0, sizeof(filename));
	port = 0;
}
void SerCon::parse(char *query, const char *s) {

	char sport[5];
	sscanf(query, s, host, sport, filename);

	printf("pares=%s", s);
	port = atoi(sport);
}
void SerCon::show(void) {
	printf("h=%s,p=%d,f=%s<br />", host, port, filename);
}
SerCon sc[5];

void print_table_row(){
	int i=0;
	printf("<tr>");
	for(i=0;i<5;i++){
		if(strlen(sc[i].host)!=0)
		{
			printf("<td>%s</td>",sc[i].host);
		}
	}
	printf("</tr>");

	printf("<tr>");
		for(i=0;i<5;i++){
			if(strlen(sc[i].host)!=0)
			{
				printf("<td valign=\"top\" id=\"m%d\"></td>",i);
			}
		}
		printf("</tr>");

}
void begin_html(){
	printf("<html>"
			"<head>"
			"<body bgcolor=#336699>"
			"<font face=\"Courier New\" size=2 color=#FFFF99>"
					"<table width=\"800\" border=\"1\">");
	print_table_row();
	printf("</table>");
	/*
    <html>
    <head>
    <meta http-equiv="Content-Type" content="text/html; charset=big5" />
    <title>Network Programming Homework 3</title>
    </head>
    <body bgcolor=#336699>
    <font face="Courier New" size=2 color=#FFFF99>
    <table width="800" border="1">
    <tr>
    <td>140.113.210.145</td><td>140.113.210.145</td><td>140.113.210.145</td></tr>
    <tr>
    <td valign="top" id="m0"></td><td valign="top" id="m1"></td><td valign="top" id="m2"></td></tr>
    </table>
    <script>document.all['m0'].innerHTML += "****************************************************************<br>";</script>
    <script>document.all['m1'].innerHTML += "****************************************************************<br>";</script>
    <script>document.all['m0'].innerHTML += "** Welcome to the information server, dist5.csie.nctu.edu.tw. **<br>";</script>
    <script>document.all['m0'].innerHTML += "** You are in the directory, /.<br>";</script>
    <script>document.all['m1'].innerHTML += "** You are in the directory, /.<br>";</script>
    <script>document.all['m2'].innerHTML += "****************************************************************<br>";</script>
    <script>document.all['m1'].innerHTML += "% <b>removetag test.html</b><br>";</script>
    <script>document.all['m1'].innerHTML += "<br>";</script>
    <script>document.all['m1'].innerHTML += "Test<br>";</script>
    <script>document.all['m1'].innerHTML += "This is a test program<br>";</script>
    <script>document.all['m1'].innerHTML += "for ras.<br>";</script>
    <script>document.all['m1'].innerHTML += "<br>";</script>
    <script>document.all['m1'].innerHTML += "<br>";</script>
    <script>document.all['m1'].innerHTML += "% <b></b><br>";</script>
    ....
    </font>
    </body>
    </html>*/

}
void end_html(){
printf("</font>"
    "</body>"
    "</html>");
}




int main(int argc, char* argv[], char *envp[]) {

	printf("Content-type: text/html\n\n");
	char *query = getenv("QUERY_STRING");
	if (query == NULL) {
		char
				testquery[] =
						"h1=127.0.0.1&p1=800&f1=test1.txt&h2=&p2=&f2=&h3=&p3=&f3=&h4=&p4=&f4=&h5=&p5=&f5=";
		query = testquery;
	}
	printf("query=%s<br />\n", query);


	try {
		const char *parse_str1 = "h1=%[^&]&p1=%d&f1=%[^&]";
		sc[0].parse(query, parse_str1);
	} catch (...) {
		cout << "s1 parse error!";
	}
	//sc[0].show();

	return 0;
}
